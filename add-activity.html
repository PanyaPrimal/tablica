<!DOCTYPE HTML>
<html>
    <head>
            <meta charset="utf-8">
            <title>Progress of skills add</title>
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body>  
        <div class="wrapper">
            <div class="form-page">
                <div class="form-page__side-menu side-menu">
                    <object class="side-menu__buttons-section" type="text/html" data="side-buttons.html"></object>
                </div>
                <div class="form-page__form-section form-section">
                    <form class="form-section__form">
                        <p class="form-section__fieldset">
                            <legend class="form-section__title title">
                                Добавить активность
                            </legend>
                            <p>
                                <label class="form-section__label-date" for="date">
                                    Дата
                                </label>
                                <input type="date" id="formSectionDate" placeholder="Дата" size="50">
                            </p>

                            <p>
                                <label class="form-section__label-time-start" for="start-time">
                                    Время начала
                                </label>
                                <input type="time" id="startTime">
                                </p>
                            <p>
                                <label class="form-section__label-time-end" for="end-time">
                                    Время окончания
                                </label>
                                <input type="time" id="endTime">
                            </p>
                            <p>
                                <div class="form-section__textarea-wrapper">
                                    <textarea 
                                        id="formSectionTextarea" 
                                        class="form-section__textarea-theme"
                                        cols="0"
                                        rows="10"
                                        placeholder="Тема и твои впечатления"></textarea>
                                </div>
                            </p>
                            <div class="button__wrapper">
                                <input class="form-section__send-button button" id="formSectionBtn" type="submit" value="Отправить">
                            </div>
                        </fieldset>
                        <fieldset style="padding: 0 0 300px 0;">
                            <legend>Some bullshit</legend>
                            <div id="lsOutput"></div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
        <script type="text/javascript">

            const inpDate = document.getElementById('formSectionDate');
            const inpStart = document.getElementById('startTime');
            const inpEnd = document.getElementById('endTime');
            const inpText = document.getElementById('formSectionTextarea');
            const btnInsert = document.getElementById('formSectionBtn');
            const storedList = JSON.parse(localStorage.getItem('list'));
            let list = storedList ? storedList : [];

            btnInsert.onclick = function(e) {
                e.preventDefault();
                const date1 = inpDate.value;
                const start1 = inpStart.value;
                const end1 = inpEnd.value;
                const text1 = inpText.value;

                let begin = start1;
                let finish = end1;
                let getDate = (string) => new Date(0, 0,0, string.split(':')[0], string.split(':')[1]);
                let different = (getDate(finish) - getDate(begin));
                let differentRes, hours, minutes;
                if(different > 0) {
                    differentRes = different;
                    hours = Math.floor((differentRes % 86400000) / 3600000);
                    minutes = Math.round(((differentRes % 86400000) % 3600000) / 60000);
                } else {
                    differentRes = Math.abs((getDate(begin) - getDate(finish)));
                    hours = Math.floor(24 - (differentRes % 86400000) / 3600000);
                    minutes = Math.round(60 - ((differentRes % 86400000) % 3600000) / 60000);
                }
                const duration1 = hours + ':' + minutes;

                if (date1 && start1 && end1 && text1) {
                    const item = {date : date1, start : start1, end : end1, text : text1, duration : duration1};
                    
                    list.push(item);

                    localStorage.setItem('list', JSON.stringify(list));
                    console.log('list', JSON.parse(localStorage.getItem('list')));
                    
                } else {
                    alert('Заполни все поля!');
                }

                inpDate.value = '';
                inpText.value = '';
                inpStart.value = '';
                inpEnd.value = '';
            };
            
        </script>
        <!--<script src="js/formPageEvents.js"></script>
        -->
        
    </body>
</html>